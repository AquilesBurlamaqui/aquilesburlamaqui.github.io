<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>üç∫ Ca√ßa Tampinhas</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            touch-action: manipulation;
            font-family: 'Nunito', sans-serif;
        }

        body {
            background: linear-gradient(180deg, #1a0a00 0%, #2d1500 30%, #3d1f00 60%, #1a0a00 100%);
        }

        /* ===================== TELA INICIAL ===================== */
        #start-screen {
            position: fixed;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, #0d0500 0%, #2d1500 40%, #4a2800 70%, #1a0a00 100%);
            z-index: 1000;
            gap: 20px;
        }

        #start-screen .logo {
            font-family: 'Fredoka One', cursive;
            font-size: clamp(2.5rem, 10vw, 4rem);
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.6), 0 4px 8px rgba(0, 0, 0, 0.5);
            text-align: center;
            animation: pulse-glow 2s ease-in-out infinite;
        }

        #start-screen .subtitle {
            font-size: clamp(0.9rem, 3vw, 1.2rem);
            color: #c8a050;
            text-align: center;
            max-width: 80%;
            line-height: 1.6;
        }

        #start-screen .cap-icon {
            font-size: 5rem;
            animation: bounce-cap 1.5s ease-in-out infinite;
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.4));
        }

        @keyframes bounce-cap {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-20px) rotate(10deg);
            }
        }

        @keyframes pulse-glow {

            0%,
            100% {
                text-shadow: 0 0 20px rgba(255, 215, 0, 0.6), 0 4px 8px rgba(0, 0, 0, 0.5);
            }

            50% {
                text-shadow: 0 0 40px rgba(255, 215, 0, 0.9), 0 4px 8px rgba(0, 0, 0, 0.5), 0 0 80px rgba(255, 165, 0, 0.3);
            }
        }

        .btn {
            padding: 16px 48px;
            border: none;
            border-radius: 50px;
            font-family: 'Fredoka One', cursive;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-play {
            background: linear-gradient(135deg, #ff8c00, #ffd700);
            color: #2d1500;
            box-shadow: 0 6px 20px rgba(255, 140, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            animation: pulse-btn 2s ease-in-out infinite;
        }

        @keyframes pulse-btn {

            0%,
            100% {
                box-shadow: 0 6px 20px rgba(255, 140, 0, 0.5);
            }

            50% {
                box-shadow: 0 6px 30px rgba(255, 140, 0, 0.8), 0 0 50px rgba(255, 215, 0, 0.3);
            }
        }

        .btn-shop {
            background: linear-gradient(135deg, #2196F3, #64B5F6);
            color: #fff;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
        }

        .btn-close {
            background: linear-gradient(135deg, #e74c3c, #ff6b6b);
            color: #fff;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
            padding: 12px 32px;
            font-size: 1rem;
        }

        /* ===================== TELA DE JOGO ===================== */
        #game-screen {
            position: fixed;
            inset: 0;
            display: none;
            flex-direction: column;
            background: linear-gradient(180deg, #1a0a00 0%, #2d1500 50%, #3d1f00 100%);
            overflow: hidden;
        }

        /* HUD */
        .hud {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: env(safe-area-inset-top, 8px) 12px 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 6px;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.7) 0%, transparent 100%);
            z-index: 100;
        }

        .hud-item {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(0, 0, 0, 0.4);
            padding: 6px 14px;
            border-radius: 25px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .hud-icon {
            font-size: 1.2rem;
        }

        .hud-value {
            font-family: 'Fredoka One', cursive;
            font-size: 1.1rem;
            color: #ffd700;
        }

        .hud-label {
            font-size: 0.65rem;
            color: #c8a050;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .hud-col {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Bot√£o da loja no HUD */
        .hud-shop-btn {
            background: linear-gradient(135deg, #2196F3, #64B5F6);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
            transition: transform 0.2s;
            position: relative;
        }

        .hud-shop-btn:active {
            transform: scale(0.9);
        }

        .hud-shop-btn .badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #e74c3c;
            color: #fff;
            font-size: 0.6rem;
            font-weight: 900;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* √Årea do jogo (canvas) */
        #game-canvas {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
        }

        /* Timer bar */
        .timer-bar-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
        }

        .timer-bar {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #ffd700, #2ecc71);
            transition: width 0.1s linear;
            border-radius: 0 3px 3px 0;
        }

        /* ===================== LOJA (modal) ===================== */
        #shop-modal {
            position: fixed;
            inset: 0;
            display: none;
            align-items: flex-end;
            justify-content: center;
            z-index: 500;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .shop-panel {
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            background: linear-gradient(180deg, #2a1a08 0%, #1a0f04 100%);
            border-radius: 24px 24px 0 0;
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-bottom: none;
            padding: 20px;
            padding-bottom: env(safe-area-inset-bottom, 20px);
            overflow-y: auto;
            animation: slide-up 0.3s ease-out;
        }

        @keyframes slide-up {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        .shop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .shop-title {
            font-family: 'Fredoka One', cursive;
            font-size: 1.5rem;
            color: #ffd700;
        }

        .shop-caps-display {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 215, 0, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .shop-caps-display span {
            font-family: 'Fredoka One', cursive;
            color: #ffd700;
            font-size: 1.1rem;
        }

        .shop-close-btn {
            background: none;
            border: none;
            color: #888;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
        }

        .beer-card {
            display: flex;
            align-items: center;
            gap: 14px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border: 1px solid rgba(255, 215, 0, 0.15);
            border-radius: 16px;
            padding: 14px;
            margin-bottom: 12px;
            transition: all 0.2s;
        }

        .beer-card:active {
            transform: scale(0.98);
        }

        .beer-card.locked {
            opacity: 0.5;
        }

        .beer-emoji {
            font-size: 2.5rem;
            min-width: 50px;
            text-align: center;
            filter: drop-shadow(0 0 8px rgba(255, 165, 0, 0.3));
        }

        .beer-info {
            flex: 1;
        }

        .beer-name {
            font-family: 'Fredoka One', cursive;
            font-size: 1rem;
            color: #f0d080;
            margin-bottom: 4px;
        }

        .beer-desc {
            font-size: 0.75rem;
            color: #a08050;
            line-height: 1.3;
        }

        .beer-points-badge {
            font-size: 0.7rem;
            color: #2ecc71;
            font-weight: 900;
            margin-top: 4px;
        }

        .beer-buy-btn {
            background: linear-gradient(135deg, #ff8c00, #ffd700);
            border: none;
            border-radius: 12px;
            padding: 10px 16px;
            font-family: 'Fredoka One', cursive;
            font-size: 0.85rem;
            color: #2d1500;
            cursor: pointer;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .beer-buy-btn:disabled {
            background: #555;
            color: #999;
            cursor: not-allowed;
        }

        .beer-buy-btn:active:not(:disabled) {
            transform: scale(0.95);
        }

        /* ===================== EFEITOS FLOAT ===================== */
        .float-text {
            position: fixed;
            font-family: 'Fredoka One', cursive;
            font-size: 1.3rem;
            pointer-events: none;
            z-index: 200;
            animation: float-up 1s ease-out forwards;
        }

        @keyframes float-up {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }

            100% {
                opacity: 0;
                transform: translateY(-80px) scale(1.3);
            }
        }

        /* Part√≠culas */
        .particle {
            position: fixed;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 150;
            animation: particle-burst 0.6s ease-out forwards;
        }

        @keyframes particle-burst {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }

            100% {
                opacity: 0;
                transform: translate(var(--dx), var(--dy)) scale(0);
            }
        }

        /* Life bar */
        .life-bar-container {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(0, 0, 0, 0.4);
            padding: 6px 12px;
            border-radius: 25px;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .life-bar-icon {
            font-size: 1.2rem;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        .life-bar-icon.low {
            animation: heartbeat-fast 0.5s ease-in-out infinite;
        }

        @keyframes heartbeat {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.15);
            }
        }

        @keyframes heartbeat-fast {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.3);
            }
        }

        .life-bar-track {
            width: 80px;
            height: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .life-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #ff6b6b);
            transition: width 0.3s ease;
            border-radius: 5px;
            box-shadow: 0 0 8px rgba(231, 76, 60, 0.5);
        }

        .life-bar-fill.medium {
            background: linear-gradient(90deg, #f39c12, #f1c40f);
            box-shadow: 0 0 8px rgba(243, 156, 18, 0.5);
        }

        .life-bar-fill.high {
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            box-shadow: 0 0 8px rgba(46, 204, 113, 0.5);
        }

        .life-bar-text {
            font-family: 'Fredoka One', cursive;
            font-size: 0.75rem;
            color: #ff6b6b;
            min-width: 20px;
            text-align: center;
        }

        /* Screen flash on damage */
        .damage-flash {
            position: fixed;
            inset: 0;
            background: rgba(231, 76, 60, 0.3);
            pointer-events: none;
            z-index: 90;
            animation: flash-out 0.3s ease-out forwards;
        }

        @keyframes flash-out {
            0% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        .heal-flash {
            position: fixed;
            inset: 0;
            background: rgba(46, 204, 113, 0.25);
            pointer-events: none;
            z-index: 90;
            animation: flash-out 0.4s ease-out forwards;
        }

        /* Tela de game over */
        #gameover-screen {
            position: fixed;
            inset: 0;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 800;
            gap: 16px;
            padding: 20px;
        }

        .gameover-title {
            font-family: 'Fredoka One', cursive;
            font-size: 2.5rem;
            color: #ffd700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .gameover-score {
            font-family: 'Fredoka One', cursive;
            font-size: 1.5rem;
            color: #f0d080;
        }

        .gameover-details {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
            margin: 10px 0;
        }

        .gameover-detail {
            font-size: 1rem;
            color: #c8a050;
        }

        .gameover-best {
            font-size: 0.9rem;
            color: #2ecc71;
            margin-top: 8px;
        }

        /* Share buttons */
        .share-container {
            display: flex;
            gap: 12px;
            margin-top: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn-share {
            padding: 12px 24px;
            border: none;
            border-radius: 50px;
            font-family: 'Fredoka One', cursive;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
        }

        .btn-share:active {
            transform: scale(0.95);
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25D366, #128C7E);
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4);
        }

        .btn-instagram {
            background: linear-gradient(135deg, #833AB4, #FD1D1D, #F77737);
            box-shadow: 0 4px 15px rgba(131, 58, 180, 0.4);
        }

        /* Orienta√ß√£o paisagem - aviso */
        .rotate-warning {
            position: fixed;
            inset: 0;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #1a0a00;
            z-index: 9999;
            gap: 20px;
        }

        .rotate-warning .icon {
            font-size: 4rem;
            animation: rotate-phone 2s ease-in-out infinite;
        }

        .rotate-warning p {
            color: #ffd700;
            font-family: 'Fredoka One', cursive;
            font-size: 1.2rem;
            text-align: center;
            padding: 0 40px;
        }

        @keyframes rotate-phone {

            0%,
            100% {
                transform: rotate(0deg);
            }

            25% {
                transform: rotate(-90deg);
            }

            75% {
                transform: rotate(-90deg);
            }
        }

        @media (orientation: landscape) and (max-height: 500px) {
            .rotate-warning {
                display: flex !important;
            }

            #start-screen,
            #game-screen,
            #shop-modal,
            #gameover-screen {
                display: none !important;
            }
        }

        /* Combo indicator */
        .combo-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Fredoka One', cursive;
            font-size: 3rem;
            color: #ffd700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 60px rgba(255, 140, 0, 0.4);
            pointer-events: none;
            z-index: 250;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .combo-indicator.show {
            opacity: 1;
            animation: combo-pop 0.5s ease-out;
        }

        @keyframes combo-pop {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
            }

            50% {
                transform: translate(-50%, -50%) scale(1.3);
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        /* Instru√ß√£o inicial */
        .tutorial-overlay {
            position: fixed;
            inset: 0;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.7);
            z-index: 150;
            gap: 15px;
            animation: fade-in 0.5s;
        }

        .tutorial-overlay p {
            color: #ffd700;
            font-family: 'Fredoka One', cursive;
            font-size: 1.2rem;
            text-align: center;
            padding: 0 30px;
        }

        .tutorial-hand {
            font-size: 3rem;
            animation: tap-anim 1s ease-in-out infinite;
        }

        @keyframes tap-anim {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(0.8);
                opacity: 0.6;
            }
        }

        @keyframes fade-in {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Scrollbar customizada para loja */
        .shop-panel::-webkit-scrollbar {
            width: 4px;
        }

        .shop-panel::-webkit-scrollbar-track {
            background: transparent;
        }

        .shop-panel::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.3);
            border-radius: 4px;
        }

        /* Level/wave banner */
        .wave-banner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Fredoka One', cursive;
            font-size: 2rem;
            color: #ffd700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.7);
            pointer-events: none;
            z-index: 200;
            opacity: 0;
        }

        .wave-banner.show {
            animation: wave-pop 2s ease-out forwards;
        }

        @keyframes wave-pop {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }

            15% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.1);
            }

            30% {
                transform: translate(-50%, -50%) scale(1);
            }

            80% {
                opacity: 1;
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1);
            }
        }
    </style>
</head>

<body>

    <!-- Aviso de rota√ß√£o -->
    <div class="rotate-warning">
        <div class="icon">üì±</div>
        <p>Gire o celular para a posi√ß√£o vertical (retrato) para jogar!</p>
    </div>

    <!-- ========== TELA INICIAL ========== -->
    <div id="start-screen">
        <div class="cap-icon">üç∫</div>
        <div class="logo">Ca√ßa Tampinhas</div>
        <div class="subtitle">Colete tampinhas, troque por cervejas e fa√ßa a maior pontua√ß√£o!</div>
        <button class="btn btn-play" onclick="startGame()">‚ñ∂ JOGAR</button>
        <div style="color:#a08050; font-size:0.75rem; margin-top:20px;">Toque nas tampinhas para colet√°-las!</div>
    </div>

    <!-- ========== TELA DO JOGO ========== -->
    <div id="game-screen">
        <!-- HUD -->
        <div class="hud">
            <div class="hud-item">
                <span class="hud-icon">‚≠ê</span>
                <div class="hud-col">
                    <span class="hud-value" id="hud-score">0</span>
                    <span class="hud-label">Pontos</span>
                </div>
            </div>

            <div class="hud-item">
                <span class="hud-icon">üß¢</span>
                <div class="hud-col">
                    <span class="hud-value" id="hud-caps">0</span>
                    <span class="hud-label">Tampinhas</span>
                </div>
            </div>

            <div class="hud-shop-btn" onclick="openShop()">
                üè™
                <div class="badge" id="shop-badge" style="display:none;">!</div>
            </div>

            <div class="life-bar-container" id="life-bar-container">
                <span class="life-bar-icon" id="life-icon">‚ù§Ô∏è</span>
                <div class="life-bar-track">
                    <div class="life-bar-fill high" id="life-bar-fill" style="width:100%"></div>
                </div>
                <span class="life-bar-text" id="life-text">5</span>
            </div>
        </div>

        <!-- Canvas -->
        <canvas id="game-canvas"></canvas>

        <!-- Timer -->
        <div class="timer-bar-container">
            <div class="timer-bar" id="timer-bar" style="width:100%"></div>
        </div>

        <!-- Combo -->
        <div class="combo-indicator" id="combo-indicator"></div>

        <!-- Wave banner -->
        <div class="wave-banner" id="wave-banner"></div>
    </div>

    <!-- ========== LOJA ========== -->
    <div id="shop-modal">
        <div class="shop-panel">
            <div class="shop-header">
                <div class="shop-title">üè™ Troca de Cervejas</div>
                <button class="shop-close-btn" onclick="closeShop()">‚úï</button>
            </div>
            <div class="shop-caps-display">
                üß¢ <span id="shop-caps">0</span> tampinhas
            </div>
            <div style="margin-top:16px;" id="beer-list"></div>
            <div style="text-align:center; margin-top:14px;">
                <button class="btn btn-close" onclick="closeShop()">Voltar ao Jogo</button>
            </div>
        </div>
    </div>

    <!-- ========== GAME OVER ========== -->
    <div id="gameover-screen">
        <div class="gameover-title" id="go-title">üíÄ Game Over!</div>
        <div class="gameover-score" id="go-score">0 pontos</div>
        <div class="gameover-details">
            <div class="gameover-detail" id="go-caps">üß¢ Tampinhas coletadas: 0</div>
            <div class="gameover-detail" id="go-beers">üç∫ Cervejas compradas: 0</div>
            <div class="gameover-detail" id="go-combo">üî• Combo m√°ximo: 0x</div>
        </div>
        <div class="gameover-best" id="go-best"></div>
        <div class="share-container">
            <button class="btn-share btn-whatsapp" onclick="shareWhatsApp()">
                üì± WhatsApp
            </button>
            <button class="btn-share btn-instagram" onclick="shareInstagram()">
                üì∏ Instagram
            </button>
        </div>
        <button class="btn btn-play" onclick="startGame()">üîÑ Jogar Novamente</button>
        <button class="btn btn-close" onclick="goToMenu()" style="margin-top:4px;">üè† Menu</button>
    </div>

    <!-- ========== TUTORIAL ========== -->
    <div class="tutorial-overlay" id="tutorial-overlay">
        <p>Toque nas tampinhas para colet√°-las!</p>
        <div class="tutorial-hand">üëÜ</div>
        <p style="font-size:0.9rem; color:#c8a050;">‚ö†Ô∏è Tampinhas que ca√≠rem = perda de vida!<br>
            üçüüçñ Colete petiscos para recuperar vida!<br>
            üè™ Troque tampinhas por cervejas para mais pontos!
        </p>
        <button class="btn btn-play" onclick="closeTutorial()"
            style="font-size:1rem; padding:12px 32px;">Entendi!</button>
    </div>

    <script>
        // ========================= CONFIGURA√á√ÉO =========================
        const GAME_DURATION = 90; // segundos
        const CAP_TYPES = [
            { type: 'bronze', emoji: 'üü§', color: '#cd7f32', points: 1, weight: 50 },
            { type: 'silver', emoji: '‚ö™', color: '#c0c0c0', points: 2, weight: 30 },
            { type: 'gold', emoji: 'üü°', color: '#ffd700', points: 5, weight: 15 },
            { type: 'diamond', emoji: 'üíé', color: '#00bfff', points: 10, weight: 5 },
        ];

        const BEERS = [
            { name: 'Cerveja Lager', emoji: 'üç∫', cost: 10, bonus: 25, desc: 'Uma lager refrescante e cl√°ssica.' },
            { name: 'Cerveja Pilsen', emoji: 'üç∫', cost: 20, bonus: 60, desc: 'Pilsen premium com sabor marcante.' },
            { name: 'Cerveja IPA', emoji: 'üçª', cost: 35, bonus: 120, desc: 'IPA artesanal com l√∫pulo especial.' },
            { name: 'Cerveja Stout', emoji: 'üçª', cost: 50, bonus: 200, desc: 'Stout escura e encorpada.' },
            { name: 'Cerveja Imperial', emoji: 'üèÜ', cost: 80, bonus: 400, desc: 'Imperial rara, a joia dos mestres!' },
            { name: 'Cerveja Lend√°ria', emoji: 'üëë', cost: 150, bonus: 1000, desc: 'A lend√°ria! Apenas para os melhores!' },
        ];

        // ========================= PETISCOS (food) =========================
        const FOOD_TYPES = [
            { type: 'batata', emoji: 'üçü', label: 'Batatinha', heal: 1, color: '#f1c40f', weight: 60 },
            { type: 'churrasco', emoji: 'üçñ', label: 'Churrasco', heal: 2, color: '#e74c3c', weight: 40 },
        ];

        const MAX_LIFE = 5;

        // ========================= ESTADO DO JOGO =========================
        let state = {
            score: 0,
            caps: 0,
            totalCapsCollected: 0,
            totalBeers: 0,
            timeLeft: GAME_DURATION,
            running: false,
            combo: 0,
            maxCombo: 0,
            lastCollectTime: 0,
            wave: 1,
            capsOnScreen: [],
            spawnInterval: null,
            gameLoop: null,
            timerInterval: null,
            shopOpen: false,
            firstPlay: true,
            life: MAX_LIFE,
            foodOnScreen: [],
            foodSpawnInterval: null,
        };

        // ========================= CANVAS =========================
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        let W, H;

        function resizeCanvas() {
            W = canvas.width = window.innerWidth;
            H = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // ========================= TAMPINHAS (objects) =========================
        class Cap {
            constructor() {
                const r = Math.random() * 100;
                let cumulative = 0;
                this.capType = CAP_TYPES[0];
                for (const ct of CAP_TYPES) {
                    cumulative += ct.weight;
                    if (r < cumulative) {
                        this.capType = ct;
                        break;
                    }
                }
                this.radius = 22 + Math.random() * 10;
                this.x = this.radius + Math.random() * (W - this.radius * 2);
                this.y = -this.radius * 2;
                this.vy = 1.2 + Math.random() * 1.5 + (state.wave * 0.15);
                this.vx = (Math.random() - 0.5) * 1.5;
                this.rotation = Math.random() * Math.PI * 2;
                this.rotSpeed = (Math.random() - 0.5) * 0.08;
                this.alive = true;
                this.opacity = 1;
                this.pulsePhase = Math.random() * Math.PI * 2;
                this.collected = false;
                this.collectAnim = 0;
            }

            update() {
                if (this.collected) {
                    this.collectAnim += 0.1;
                    this.opacity = Math.max(0, 1 - this.collectAnim);
                    this.radius += 1.5;
                    if (this.opacity <= 0) this.alive = false;
                    return;
                }
                this.y += this.vy;
                this.x += this.vx;
                this.rotation += this.rotSpeed;
                this.pulsePhase += 0.05;

                // Bouncing off walls
                if (this.x < this.radius) { this.x = this.radius; this.vx *= -1; }
                if (this.x > W - this.radius) { this.x = W - this.radius; this.vx *= -1; }

                // Off screen bottom ‚Äî lose life!
                if (this.y > H + this.radius * 2) {
                    this.alive = false;
                    // Reset combo on miss
                    if (state.combo > 0) {
                        state.combo = 0;
                        updateComboIndicator();
                    }
                    // Lose life
                    takeDamage(1);
                }
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.opacity;
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                const pulse = 1 + Math.sin(this.pulsePhase) * 0.08;
                const r = this.radius * pulse;

                // Shadow
                ctx.shadowColor = this.capType.color;
                ctx.shadowBlur = 15;

                // Outer circle (cap)
                ctx.beginPath();
                ctx.arc(0, 0, r, 0, Math.PI * 2);
                const grad = ctx.createRadialGradient(- r * 0.3, -r * 0.3, r * 0.1, 0, 0, r);
                grad.addColorStop(0, lightenColor(this.capType.color, 40));
                grad.addColorStop(0.7, this.capType.color);
                grad.addColorStop(1, darkenColor(this.capType.color, 30));
                ctx.fillStyle = grad;
                ctx.fill();

                // Serrated edge
                ctx.shadowBlur = 0;
                const teeth = 16;
                ctx.beginPath();
                for (let i = 0; i < teeth; i++) {
                    const a = (i / teeth) * Math.PI * 2;
                    const outerR = r + 3;
                    const innerR = r - 1;
                    ctx.lineTo(Math.cos(a) * outerR, Math.sin(a) * outerR);
                    const a2 = ((i + 0.5) / teeth) * Math.PI * 2;
                    ctx.lineTo(Math.cos(a2) * innerR, Math.sin(a2) * innerR);
                }
                ctx.closePath();
                ctx.strokeStyle = darkenColor(this.capType.color, 20);
                ctx.lineWidth = 1.5;
                ctx.stroke();

                // Inner circle
                ctx.beginPath();
                ctx.arc(0, 0, r * 0.6, 0, Math.PI * 2);
                ctx.fillStyle = darkenColor(this.capType.color, 15);
                ctx.fill();

                // Points text
                ctx.shadowBlur = 0;
                ctx.fillStyle = '#fff';
                ctx.font = `bold ${r * 0.55}px 'Fredoka One', cursive`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.capType.points, 0, 1);

                ctx.restore();
            }

            containsPoint(px, py) {
                if (this.collected) return false;
                const dx = px - this.x;
                const dy = py - this.y;
                return (dx * dx + dy * dy) <= (this.radius + 10) * (this.radius + 10);
            }

            collect() {
                this.collected = true;
                state.caps += this.capType.points;
                state.totalCapsCollected++;

                // Combo
                const now = Date.now();
                if (now - state.lastCollectTime < 800) {
                    state.combo++;
                } else {
                    state.combo = 1;
                }
                state.lastCollectTime = now;
                state.maxCombo = Math.max(state.maxCombo, state.combo);

                // Combo bonus
                let comboMultiplier = 1;
                if (state.combo >= 10) comboMultiplier = 3;
                else if (state.combo >= 5) comboMultiplier = 2;
                else if (state.combo >= 3) comboMultiplier = 1.5;

                const earnedPoints = Math.floor(this.capType.points * comboMultiplier);
                state.score += earnedPoints;

                // FX
                showFloatText(this.x, this.y, `+${earnedPoints}`, this.capType.color);
                spawnParticles(this.x, this.y, this.capType.color);
                updateHUD();
                updateComboIndicator();
            }
        }

        // ========================= FOOD ITEM CLASS =========================
        class FoodItem {
            constructor() {
                const r = Math.random() * 100;
                let cumulative = 0;
                this.foodType = FOOD_TYPES[0];
                for (const ft of FOOD_TYPES) {
                    cumulative += ft.weight;
                    if (r < cumulative) {
                        this.foodType = ft;
                        break;
                    }
                }
                this.radius = 20;
                this.x = this.radius + Math.random() * (W - this.radius * 2);
                this.y = -this.radius * 2;
                this.vy = 1.0 + Math.random() * 1.0 + (state.wave * 0.1);
                this.vx = (Math.random() - 0.5) * 2;
                this.alive = true;
                this.opacity = 1;
                this.pulsePhase = Math.random() * Math.PI * 2;
                this.collected = false;
                this.collectAnim = 0;
                this.bobPhase = Math.random() * Math.PI * 2;
            }

            update() {
                if (this.collected) {
                    this.collectAnim += 0.1;
                    this.opacity = Math.max(0, 1 - this.collectAnim);
                    if (this.opacity <= 0) this.alive = false;
                    return;
                }
                this.y += this.vy;
                this.bobPhase += 0.06;
                this.x += this.vx + Math.sin(this.bobPhase) * 0.5;
                this.pulsePhase += 0.05;

                // Bouncing off walls
                if (this.x < this.radius) { this.x = this.radius; this.vx *= -1; }
                if (this.x > W - this.radius) { this.x = W - this.radius; this.vx *= -1; }

                // Off screen bottom (food just disappears, no penalty)
                if (this.y > H + this.radius * 2) {
                    this.alive = false;
                }
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.opacity;
                ctx.translate(this.x, this.y);

                const pulse = 1 + Math.sin(this.pulsePhase) * 0.1;
                const size = this.radius * pulse;

                // Glow
                ctx.shadowColor = this.foodType.color;
                ctx.shadowBlur = 20;

                // Background circle
                ctx.beginPath();
                ctx.arc(0, 0, size + 4, 0, Math.PI * 2);
                const grad = ctx.createRadialGradient(0, 0, size * 0.2, 0, 0, size + 4);
                grad.addColorStop(0, 'rgba(46, 204, 113, 0.4)');
                grad.addColorStop(1, 'rgba(46, 204, 113, 0.1)');
                ctx.fillStyle = grad;
                ctx.fill();

                // Green border
                ctx.beginPath();
                ctx.arc(0, 0, size + 2, 0, Math.PI * 2);
                ctx.strokeStyle = 'rgba(46, 204, 113, 0.6)';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Emoji
                ctx.shadowBlur = 0;
                ctx.font = `${size * 1.3}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.foodType.emoji, 0, 2);

                // Heal indicator
                ctx.font = `bold ${size * 0.5}px 'Fredoka One', cursive`;
                ctx.fillStyle = '#2ecc71';
                ctx.fillText(`+${this.foodType.heal}‚ù§`, 0, -size - 8);

                ctx.restore();
            }

            containsPoint(px, py) {
                if (this.collected) return false;
                const dx = px - this.x;
                const dy = py - this.y;
                return (dx * dx + dy * dy) <= (this.radius + 15) * (this.radius + 15);
            }

            collect() {
                this.collected = true;
                // Heal
                healLife(this.foodType.heal);
                // FX
                showFloatText(this.x, this.y, `+${this.foodType.heal}‚ù§Ô∏è ${this.foodType.label}`, '#2ecc71');
                spawnParticles(this.x, this.y, '#2ecc71');
                // Heal flash
                const flash = document.createElement('div');
                flash.className = 'heal-flash';
                document.body.appendChild(flash);
                setTimeout(() => flash.remove(), 400);
            }
        }

        // ========================= LIFE SYSTEM =========================
        function takeDamage(amount) {
            state.life = Math.max(0, state.life - amount);
            updateLifeBar();
            // Screen flash
            const flash = document.createElement('div');
            flash.className = 'damage-flash';
            document.body.appendChild(flash);
            setTimeout(() => flash.remove(), 300);
            // Vibrate if supported
            if (navigator.vibrate) navigator.vibrate(100);
            // Check game over
            if (state.life <= 0) {
                gameOver('life');
            }
        }

        function healLife(amount) {
            state.life = Math.min(MAX_LIFE, state.life + amount);
            updateLifeBar();
        }

        function updateLifeBar() {
            const pct = (state.life / MAX_LIFE) * 100;
            const fill = document.getElementById('life-bar-fill');
            fill.style.width = pct + '%';
            // Color classes
            fill.classList.remove('high', 'medium');
            if (pct > 60) fill.classList.add('high');
            else if (pct > 30) fill.classList.add('medium');
            // Text
            document.getElementById('life-text').textContent = state.life;
            // Heart icon animation
            const icon = document.getElementById('life-icon');
            if (state.life <= 2) {
                icon.classList.add('low');
            } else {
                icon.classList.remove('low');
            }
        }

        // ========================= HELPER FUNCTIONS =========================
        function lightenColor(hex, amount) {
            const c = hexToRgb(hex);
            return `rgb(${Math.min(255, c.r + amount)}, ${Math.min(255, c.g + amount)}, ${Math.min(255, c.b + amount)})`;
        }

        function darkenColor(hex, amount) {
            const c = hexToRgb(hex);
            return `rgb(${Math.max(0, c.r - amount)}, ${Math.max(0, c.g - amount)}, ${Math.max(0, c.b - amount)})`;
        }

        function hexToRgb(hex) {
            hex = hex.replace('#', '');
            return {
                r: parseInt(hex.substring(0, 2), 16),
                g: parseInt(hex.substring(2, 4), 16),
                b: parseInt(hex.substring(4, 6), 16)
            };
        }

        // ========================= EFEITOS VISUAIS =========================
        function showFloatText(x, y, text, color) {
            const el = document.createElement('div');
            el.className = 'float-text';
            el.textContent = text;
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            el.style.color = color;
            el.style.textShadow = `0 0 10px ${color}`;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        function spawnParticles(x, y, color) {
            for (let i = 0; i < 8; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                p.style.background = color;
                const angle = (i / 8) * Math.PI * 2;
                const dist = 30 + Math.random() * 40;
                p.style.setProperty('--dx', Math.cos(angle) * dist + 'px');
                p.style.setProperty('--dy', Math.sin(angle) * dist + 'px');
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 600);
            }
        }

        function updateComboIndicator() {
            const el = document.getElementById('combo-indicator');
            if (state.combo >= 3) {
                el.textContent = `üî• ${state.combo}x COMBO!`;
                el.classList.add('show');
                clearTimeout(el._timeout);
                el._timeout = setTimeout(() => el.classList.remove('show'), 1500);
            }
        }

        function showWaveBanner(wave) {
            const el = document.getElementById('wave-banner');
            el.textContent = `üåä Onda ${wave}!`;
            el.classList.remove('show');
            void el.offsetWidth;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 2500);
        }

        // ========================= HUD =========================
        function updateHUD() {
            document.getElementById('hud-score').textContent = state.score;
            document.getElementById('hud-caps').textContent = state.caps;
            // Check if shop has available items
            const canBuy = BEERS.some(b => state.caps >= b.cost);
            const badge = document.getElementById('shop-badge');
            badge.style.display = canBuy ? 'flex' : 'none';
            updateLifeBar();
        }

        // ========================= BACKGROUND DRAWING =========================
        function drawBackground() {
            // Gradient already set by CSS, draw subtle wood-floor pattern
            ctx.fillStyle = 'rgba(45, 21, 0, 0.3)';
            ctx.fillRect(0, 0, W, H);

            // Wood planks
            ctx.strokeStyle = 'rgba(100, 60, 20, 0.15)';
            ctx.lineWidth = 1;
            const plankH = 60;
            for (let y = 0; y < H; y += plankH) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(W, y);
                ctx.stroke();
                // Vertical dividers
                const offset = (Math.floor(y / plankH) % 2) * (W / 3);
                for (let x = offset; x < W; x += W / 2) {
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(x, y + plankH);
                    ctx.stroke();
                }
            }

            // Subtle vignette
            const vignette = ctx.createRadialGradient(W / 2, H / 2, W * 0.3, W / 2, H / 2, W * 0.8);
            vignette.addColorStop(0, 'rgba(0,0,0,0)');
            vignette.addColorStop(1, 'rgba(0,0,0,0.4)');
            ctx.fillStyle = vignette;
            ctx.fillRect(0, 0, W, H);
        }

        // ========================= SPAWN =========================
        function spawnCap() {
            if (!state.running) return;
            state.capsOnScreen.push(new Cap());
        }

        function spawnFood() {
            if (!state.running) return;
            state.foodOnScreen.push(new FoodItem());
        }

        function getSpawnRate() {
            // Faster spawns as waves progress
            return Math.max(300, 1000 - state.wave * 80);
        }

        function startSpawning() {
            if (state.spawnInterval) clearInterval(state.spawnInterval);
            state.spawnInterval = setInterval(() => {
                if (!state.running || state.shopOpen) return;
                const count = Math.min(3, 1 + Math.floor(state.wave / 3));
                for (let i = 0; i < count; i++) {
                    setTimeout(() => spawnCap(), i * 150);
                }
            }, getSpawnRate());

            // Food spawn (less frequent)
            if (state.foodSpawnInterval) clearInterval(state.foodSpawnInterval);
            state.foodSpawnInterval = setInterval(() => {
                if (!state.running || state.shopOpen) return;
                if (state.life < MAX_LIFE && Math.random() < 0.6) {
                    spawnFood();
                }
            }, 4000 + Math.random() * 2000);
        }

        // ========================= WAVES =========================
        function checkWaveProgress() {
            const newWave = Math.floor(state.totalCapsCollected / 15) + 1;
            if (newWave > state.wave) {
                state.wave = newWave;
                showWaveBanner(state.wave);
                // Restart spawning with updated rate
                startSpawning();
            }
        }

        // ========================= GAME LOOP =========================
        function gameLoopFn() {
            if (!state.running) return;

            ctx.clearRect(0, 0, W, H);
            drawBackground();

            // Update & draw caps
            for (const cap of state.capsOnScreen) {
                cap.update();
                cap.draw();
            }

            // Update & draw food items
            for (const food of state.foodOnScreen) {
                food.update();
                food.draw();
            }

            // Remove dead caps & food
            state.capsOnScreen = state.capsOnScreen.filter(c => c.alive);
            state.foodOnScreen = state.foodOnScreen.filter(f => f.alive);

            checkWaveProgress();

            state.gameLoop = requestAnimationFrame(gameLoopFn);
        }

        // ========================= TIMER =========================
        function startTimer() {
            state.timeLeft = GAME_DURATION;
            const timerBar = document.getElementById('timer-bar');
            state.timerInterval = setInterval(() => {
                if (!state.running || state.shopOpen) return;
                state.timeLeft -= 0.1;
                const pct = Math.max(0, (state.timeLeft / GAME_DURATION) * 100);
                timerBar.style.width = pct + '%';

                if (state.timeLeft <= 0) {
                    gameOver('time');
                }
            }, 100);
        }

        // ========================= INPUT =========================
        canvas.addEventListener('pointerdown', (e) => {
            if (!state.running || state.shopOpen) return;
            const rect = canvas.getBoundingClientRect();
            const px = e.clientX - rect.left;
            const py = e.clientY - rect.top;

            // Check food items first (they are rarer and more important)
            for (let i = state.foodOnScreen.length - 1; i >= 0; i--) {
                if (state.foodOnScreen[i].containsPoint(px, py)) {
                    state.foodOnScreen[i].collect();
                    return;
                }
            }

            // Check caps from top (newest) to bottom
            for (let i = state.capsOnScreen.length - 1; i >= 0; i--) {
                if (state.capsOnScreen[i].containsPoint(px, py)) {
                    state.capsOnScreen[i].collect();
                    break;
                }
            }
        });

        // ========================= LOJA =========================
        function openShop() {
            if (!state.running) return;
            state.shopOpen = true;
            document.getElementById('shop-modal').style.display = 'flex';
            document.getElementById('shop-caps').textContent = state.caps;
            renderBeerList();
        }

        function closeShop() {
            state.shopOpen = false;
            document.getElementById('shop-modal').style.display = 'none';
        }

        function renderBeerList() {
            const container = document.getElementById('beer-list');
            container.innerHTML = '';
            for (const beer of BEERS) {
                const canAfford = state.caps >= beer.cost;
                const card = document.createElement('div');
                card.className = 'beer-card' + (canAfford ? '' : ' locked');
                card.innerHTML = `
      <div class="beer-emoji">${beer.emoji}</div>
      <div class="beer-info">
        <div class="beer-name">${beer.name}</div>
        <div class="beer-desc">${beer.desc}</div>
        <div class="beer-points-badge">+${beer.bonus} pontos de b√¥nus</div>
      </div>
      <button class="beer-buy-btn" ${canAfford ? '' : 'disabled'}
        onclick="buyBeer(${BEERS.indexOf(beer)})">
        üß¢ ${beer.cost}
      </button>
    `;
                container.appendChild(card);
            }
        }

        function buyBeer(index) {
            const beer = BEERS[index];
            if (state.caps < beer.cost) return;

            state.caps -= beer.cost;
            state.score += beer.bonus;
            state.totalBeers++;

            // Big FX
            showFloatText(W / 2, H / 2, `üç∫ +${beer.bonus} pts!`, '#ffd700');
            for (let i = 0; i < 3; i++) {
                setTimeout(() => spawnParticles(W / 2 + (Math.random() - 0.5) * 100, H / 2, '#ffd700'), i * 100);
            }

            updateHUD();
            document.getElementById('shop-caps').textContent = state.caps;
            renderBeerList();
        }

        // ========================= GAME OVER =========================
        function gameOver(reason) {
            state.running = false;
            clearInterval(state.spawnInterval);
            clearInterval(state.timerInterval);
            clearInterval(state.foodSpawnInterval);
            cancelAnimationFrame(state.gameLoop);

            // Title based on reason
            const titleEl = document.getElementById('go-title');
            if (reason === 'life') {
                titleEl.textContent = 'üíÄ Game Over!';
            } else {
                titleEl.textContent = '‚è∞ Tempo Esgotado!';
            }

            document.getElementById('go-score').textContent = state.score + ' pontos';
            document.getElementById('go-caps').textContent = 'üß¢ Tampinhas coletadas: ' + state.totalCapsCollected;
            document.getElementById('go-beers').textContent = 'üç∫ Cervejas compradas: ' + state.totalBeers;
            document.getElementById('go-combo').textContent = 'üî• Combo m√°ximo: ' + state.maxCombo + 'x';

            // Best score
            const best = parseInt(localStorage.getItem('capgame-best') || '0');
            if (state.score > best) {
                localStorage.setItem('capgame-best', state.score);
                document.getElementById('go-best').textContent = 'üèÜ Novo recorde! ' + state.score + ' pontos!';
                document.getElementById('go-best').style.color = '#ffd700';
            } else {
                document.getElementById('go-best').textContent = 'üèÜ Melhor pontua√ß√£o: ' + best + ' pontos';
                document.getElementById('go-best').style.color = '#2ecc71';
            }

            document.getElementById('gameover-screen').style.display = 'flex';
        }

        // ========================= SHARE =========================
        function getShareText() {
            return `üç∫ Ca√ßa Tampinhas üç∫\n\nFiz ${state.score} pontos!\nüß¢ ${state.totalCapsCollected} tampinhas coletadas\nüç∫ ${state.totalBeers} cervejas compradas\nüî• Combo m√°ximo: ${state.maxCombo}x\n\nConsegue me superar? Jogue agora! üëá\n${window.location.href}`;
        }

        function shareWhatsApp() {
            const text = encodeURIComponent(getShareText());
            window.open(`https://wa.me/?text=${text}`, '_blank');
        }

        function shareInstagram() {
            // Instagram doesn't support direct text sharing via URL,
            // so we copy to clipboard and open Instagram
            const text = getShareText();
            navigator.clipboard.writeText(text).then(() => {
                alert('Resultado copiado! Cole no seu Story ou Direct do Instagram üì∏');
                window.open('https://www.instagram.com/', '_blank');
            }).catch(() => {
                // Fallback: show text for manual copy
                prompt('Copie e compartilhe no Instagram:', text);
            });
        }

        // ========================= START GAME =========================
        function startGame() {
            // Reset state
            state.score = 0;
            state.caps = 0;
            state.totalCapsCollected = 0;
            state.totalBeers = 0;
            state.timeLeft = GAME_DURATION;
            state.running = true;
            state.combo = 0;
            state.maxCombo = 0;
            state.lastCollectTime = 0;
            state.wave = 1;
            state.capsOnScreen = [];
            state.foodOnScreen = [];
            state.shopOpen = false;
            state.life = MAX_LIFE;

            // Clear intervals
            clearInterval(state.spawnInterval);
            clearInterval(state.timerInterval);
            clearInterval(state.foodSpawnInterval);
            cancelAnimationFrame(state.gameLoop);

            // UI
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('gameover-screen').style.display = 'none';
            document.getElementById('shop-modal').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';

            updateHUD();
            resizeCanvas();

            // Show tutorial on first play
            if (state.firstPlay) {
                state.firstPlay = false;
                document.getElementById('tutorial-overlay').style.display = 'flex';
                state.running = false;
                return;
            }

            // Start
            startSpawning();
            startTimer();
            gameLoopFn();
        }

        function closeTutorial() {
            document.getElementById('tutorial-overlay').style.display = 'none';
            state.running = true;
            startSpawning();
            startTimer();
            gameLoopFn();
        }

        function goToMenu() {
            document.getElementById('gameover-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('start-screen').style.display = 'flex';
        }

        // ========================= FULLSCREEN =========================
        document.addEventListener('click', () => {
            if (!document.fullscreenElement && document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen().catch(() => { });
            }
        }, { once: true });

        // Prevent scrolling & bouncing
        document.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });
        document.addEventListener('gesturestart', (e) => e.preventDefault());
    </script>

</body>

</html>